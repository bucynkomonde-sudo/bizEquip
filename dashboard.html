<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Biz Equip - Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<!-- jsPDF and SheetJS (xlsx) CDNs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:"Montserrat",sans-serif;
    display:flex;height:100vh;background:#f9f9f9;color:#001f3f;overflow:hidden;
  }

  /* Sidebar */
  .sidebar{
    width:260px;background:#001f3f;color:#FFD700;display:flex;flex-direction:column;padding:1.75rem;
    position:relative;
  }
  .sidebar h2{font-size:1.4rem;margin-bottom:1rem}
  .navlink{color:#FFD700;text-decoration:none;margin:0.4rem 0;display:flex;align-items:center;padding:0.5rem;border-radius:6px;cursor:pointer}
  .navlink:hover{background:#003366}
  .navlink i{margin-right:0.6rem}
  .logout-fixed{position:absolute;left:1.75rem;right:1.75rem;bottom:1.75rem}
  .logout-fixed button{width:100%;background:#FFD700;color:#001f3f;border:none;padding:0.6rem;border-radius:6px;font-weight:700;cursor:pointer}
  .sidebar-scroll{overflow:auto;padding-bottom:3.5rem}

  /* main */
  .main{flex:1;padding:22px;overflow:auto}
  .top-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
  .profile-left{display:flex;gap:12px;align-items:center}
  .avatar{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#7C3AED,#06B6D4);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
  .user-info .name{font-weight:700;font-size:18px}
  .user-info .industry{font-size:13px;color:rgba(0,31,63,0.7);margin-top:4px}
  .edit-btn{background:#ffd700;color:#001f3f;border:0;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:700}
  .welcome{font-size:1.05rem;margin-bottom:10px;color:#001f3f}

  h3{margin-bottom:8px;color:#001f3f}
  .muted{color:rgba(0,31,63,0.7);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:780px){ .grid{grid-template-columns:repeat(3,1fr)} }
  .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  .card strong{display:block;margin-bottom:6px}
  a.btn{display:inline-block;padding:8px 12px;background:#FFD700;color:#001f3f;border-radius:6px;text-decoration:none;font-weight:700}
  a.btn:hover{background:#FFC300}
  .section{display:none}
  .section.active{display:block}
  .small{font-size:13px;color:rgba(0,31,63,0.6);margin-top:6px}
  label{font-weight:600}
  input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #ccc;margin:6px 0;font-size:14px}
  .row{display:flex;gap:12px}
  .row .col{flex:1}
  .inline{display:flex;gap:8px;align-items:center}
  .actions{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
  .smallmuted{font-size:12px;color:#666;margin-top:6px}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="sidebar-scroll">
    <h2>Biz Equip</h2>
    <div class="navlink" data-section="journey"><i>üß≠</i><span>Your Journey</span></div>
    <div class="navlink" data-section="register"><i>üìù</i><span>Register Business</span></div>
    <div class="navlink" data-section="financial"><i>üí∞</i><span>Financial Tools</span></div>
    <div class="navlink" data-section="templates"><i>üìÑ</i><span>Business Templates</span></div>
    <div class="navlink" data-section="mentors"><i>üë©üè´</i><span>Mentors</span></div>
    <div class="navlink" data-section="courses"><i>üéì</i><span>Short Courses</span></div>
    <div class="navlink" data-section="tenders"><i>üìë</i><span>Tender Learning</span></div>
    <div class="navlink" data-section="partnerships"><i>ü§ù</i><span>Partnerships</span></div>
    <div class="navlink" data-section="suppliers"><i>üè≠</i><span>Suppliers</span></div>
    <div class="navlink" data-section="events"><i>üìÖ</i><span>Events & Community</span></div>
    <div class="navlink" data-section="videos"><i>üé•</i><span>Video Tutorials</span></div>
    <div class="navlink" data-section="funding"><i>üí∏</i><span>Access to Funding</span></div>
  </div>

  <div class="logout-fixed">
    <button id="logoutBtn">Logout</button>
  </div>
</div>

<!-- Main -->
<div class="main">
  <div class="top-row">
    <div class="profile-left">
      <div class="avatar" id="avatarInitials">N</div>
      <div class="user-info">
        <div class="name" id="displayName">User</div>
        <div class="industry" id="displayIndustry">Industry: ‚Äî</div>
      </div>
    </div>
    <button class="edit-btn" id="editProfileBtn">Edit Profile</button>
  </div>

  <div class="welcome" id="welcomeMsg">Welcome back ‚Äî here's your dashboard overview.</div>

  <!-- Your Journey -->
  <div class="section" id="journey">
    <h3>Your Journey</h3>
    <p class="muted">This will be your personalised step-by-step roadmap. (Placeholder ‚Äî we'll add modules and milestones.)</p>
  </div>

  <!-- Register Business -->
  <div class="section" id="register">
    <h3>Register Your Business</h3>
    <p class="muted">Use these official registration portals:</p>
    <div class="grid" style="margin-top:10px">
      <div class="card">
        <strong>CIDB</strong>
        <div class="small">Construction Industry Development Board ‚Äî register to access construction tenders.</div>
        <div class="actions"><a class="btn" href="https://www.cidb.org.za/" target="_blank">Go to CIDB</a></div>
      </div>
      <div class="card">
        <strong>CSD</strong>
        <div class="small">Central Supplier Database ‚Äî government procurement listing.</div>
        <div class="actions"><a class="btn" href="https://secure.csd.gov.za" target="_blank">Go to CSD</a></div>
      </div>
      <div class="card">
        <strong>SARS</strong>
        <div class="small">Tax & VAT registration.</div>
        <div class="actions"><a class="btn" href="https://www.sars.gov.za" target="_blank">Go to SARS</a></div>
      </div>
      <div class="card">
        <strong>CIPC</strong>
        <div class="small">Company registration, documents & filings.</div>
        <div class="actions"><a class="btn" href="https://www.cipc.co.za" target="_blank">Go to CIPC</a></div>
      </div>
    </div>
  </div>

  <!-- Financial Tools -->
  <div class="section" id="financial">
    <h3>Financial Tools</h3>
    <p class="muted">Budgeting, cashflow, pricing, invoices and quotations.</p>

    <div style="margin-top:12px" class="grid">

      <!-- Budget Planner -->
      <div class="card">
        <strong>Budget Planner</strong>
        <div class="small">Add monthly income and expenses to estimate profit.</div>
        <div style="margin-top:8px">
          <label>Monthly income</label>
          <input id="bp-income" type="number" placeholder="Total income per month (ZAR)">
          <label>Monthly expenses</label>
          <input id="bp-expenses" type="number" placeholder="Total expenses per month (ZAR)">
          <div class="actions">
            <button class="btn" onclick="runBudget()">Calculate</button>
            <a class="btn" href="#" id="bp-download" style="display:none">Download CSV</a>
          </div>
          <div id="bp-output" class="smallmuted"></div>
        </div>
      </div>

      <!-- Cashflow -->
      <div class="card">
        <strong>Cashflow Calculator</strong>
        <div class="small">Project cashflow for 12 months quickly.</div>
        <div style="margin-top:8px">
          <label>Starting balance</label>
          <input id="cf-start" type="number" placeholder="Starting cash balance (ZAR)">
          <label>Monthly net change (income - expenses)</label>
          <input id="cf-month" type="number" placeholder="Net monthly change (ZAR)">
          <div class="actions">
            <button class="btn" onclick="runCashflow()">Project 12 months</button>
            <a class="btn" id="cf-download" style="display:none">Download CSV</a>
          </div>
          <div id="cf-output" class="smallmuted"></div>
        </div>
      </div>

      <!-- Pricing -->
      <div class="card">
        <strong>Pricing & Costing</strong>
        <div class="small">Calculate cost, markup and recommended retail price.</div>
        <div style="margin-top:8px">
          <label>Unit cost</label><input id="price-cost" type="number" placeholder="Cost per unit (ZAR)">
          <label>Desired markup (%)</label><input id="price-markup" type="number" placeholder="e.g. 30">
          <div class="actions">
            <button class="btn" onclick="calcPrice()">Calculate Price</button>
            <a class="btn" id="price-download" style="display:none">Download</a>
          </div>
          <div id="price-output" class="smallmuted"></div>
        </div>
      </div>

      <!-- Invoice Builder (full-width) -->
      <div class="card" style="grid-column:1/ -1">
        <strong>Invoice Builder</strong>
        <div class="small">Create invoice, download (XLSX/PDF) or send via email (Netlify function).</div>
        <div style="margin-top:8px">
          <div class="row">
            <div class="col"><label>Invoice No</label><input id="inv-no" type="text" placeholder="INV-001"></div>
            <div class="col"><label>Invoice Date</label><input id="inv-date" type="date"></div>
          </div>

          <label>Bill To (client name)</label><input id="inv-client" type="text" placeholder="Client name">
          <label>Client Email</label><input id="inv-client-email" type="email" placeholder="client@example.com">

          <div id="invoice-items">
            <div class="row item-row">
              <div class="col"><input class="item-desc" placeholder="Description"></div>
              <div style="width:110px"><input class="item-qty" type="number" placeholder="Qty"></div>
              <div style="width:140px"><input class="item-price" type="number" placeholder="Unit price"></div>
              <div style="width:80px"><button class="btn" onclick="this.closest('.item-row').remove()">Del</button></div>
            </div>
          </div>

          <div style="margin-top:8px">
            <button class="btn" onclick="addInvoiceRow()">+ Add item</button>
          </div>

          <div class="actions" style="margin-top:10px">
            <button class="btn" onclick="generateInvoiceXLSX()">Download XLSX</button>
            <button class="btn" onclick="generateInvoicePDF()">Download PDF</button>
            <button class="btn" onclick="emailInvoice()">Send via Email</button>
          </div>
          <div id="inv-msg" class="smallmuted"></div>
        </div>
      </div>

      <!-- Quotation Builder -->
      <div class="card" style="grid-column:1/ -1">
        <strong>Quotation Builder</strong>
        <div class="small">Create quotation, download (XLSX/PDF) or email (Netlify function).</div>
        <div style="margin-top:8px">
          <div class="row">
            <div class="col"><label>Quotation No</label><input id="qt-no" type="text" placeholder="QT-001"></div>
            <div class="col"><label>Date</label><input id="qt-date" type="date"></div>
          </div>
          <label>Client</label><input id="qt-client" type="text" placeholder="Client name">
          <label>Client Email</label><input id="qt-client-email" type="email" placeholder="client@example.com">

          <div id="quote-items">
            <div class="row q-item">
              <div class="col"><input class="q-desc" placeholder="Description"></div>
              <div style="width:110px"><input class="q-qty" type="number" placeholder="Qty"></div>
              <div style="width:140px"><input class="q-price" type="number" placeholder="Unit price"></div>
              <div style="width:80px"><button class="btn" onclick="this.closest('.q-item').remove()">Del</button></div>
            </div>
          </div>

          <div style="margin-top:8px">
            <button class="btn" onclick="addQuoteRow()">+ Add item</button>
          </div>

          <div class="actions" style="margin-top:10px">
            <button class="btn" onclick="generateQuoteXLSX()">Download XLSX</button>
            <button class="btn" onclick="generateQuotePDF()">Download PDF</button>
            <button class="btn" onclick="emailQuote()">Send via Email</button>
          </div>
          <div id="qt-msg" class="smallmuted"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- Access to Funding -->
  <div class="section" id="funding">
    <h3>Access to Funding (SA)</h3>
    <p class="muted">Links to major South African grants / funding programmes.</p>
    <div class="grid" style="margin-top:10px">
      <div class="card"><strong>SEDA</strong><div class="small">Small Enterprise Development Agency</div><a class="btn" href="https://www.seda.org.za" target="_blank">Visit</a></div>
      <div class="card"><strong>DTI</strong><div class="small">Department of Trade, Industry & Competition</div><a class="btn" href="https://www.thedtic.gov.za" target="_blank">Visit</a></div>
      <div class="card"><strong>IDC</strong><div class="small">Industrial Development Corporation</div><a class="btn" href="https://www.idc.co.za" target="_blank">Visit</a></div>
      <div class="card"><strong>NEF</strong><div class="small">National Empowerment Fund</div><a class="btn" href="https://www.nefcorp.co.za" target="_blank">Visit</a></div>
      <div class="card"><strong>NYDA</strong><div class="small">National Youth Development Agency</div><a class="btn" href="https://www.nyda.gov.za" target="_blank">Visit</a></div>
      <div class="card"><strong>DBSA</strong><div class="small">Development Bank of Southern Africa</div><a class="btn" href="https://www.dbsa.org" target="_blank">Visit</a></div>
    </div>
  </div>

  <!-- Business Templates -->
  <div class="section" id="templates">
    <h3>Business Templates</h3>
    <p class="muted">Invoice (XLSX), Quotation (XLSX), Business Plan (Word)</p>
    <div class="grid" style="margin-top:10px">
      <div class="card">
        <strong>Invoice Template (XLSX)</strong>
        <div class="small">Standard invoice layout, opens in Excel.</div>
        <div class="actions"><a class="btn" id="download-invoice-template" href="#">Download XLSX</a></div>
      </div>
      <div class="card">
        <strong>Quotation Template (XLSX)</strong>
        <div class="small">Quotation layout for Excel.</div>
        <div class="actions"><a class="btn" id="download-quote-template" href="#">Download XLSX</a></div>
      </div>
      <div class="card">
        <strong>Business Plan (Word)</strong>
        <div class="small">Editable business plan template (DOC).</div>
        <div class="actions"><a class="btn" id="download-plan-template" href="#">Download .doc</a></div>
      </div>
    </div>
  </div>

  <!-- Mentors -->
  <div class="section" id="mentors">
    <h3>Mentors</h3>
    <p class="muted">Mentors tailored to your industry and goal. Request intro or book a 1:1.</p>
    <div id="mentors-grid" class="grid" style="margin-top:10px"></div>
  </div>

  <!-- Short Courses -->
  <div class="section" id="courses">
    <h3>Short Courses</h3>
    <p class="muted">Learn practical entrepreneurship skills.</p>
    <div class="grid" style="margin-top:10px">
      <div class="card"><strong>Nelson Mandela University ‚Äî Business School</strong><div class="small">Modular entrepreneurship & management courses.</div><a class="btn" href="https://business.mandela.ac.za/" target="_blank">View NMU</a></div>
      <div class="card"><strong>Coursera ‚Äî Entrepreneurship</strong><div class="small">University-led online entrepreneurship courses.</div><a class="btn" href="https://www.coursera.org/browse/business" target="_blank">View Coursera</a></div>
      <div class="card"><strong>Udemy ‚Äî Entrepreneurship</strong><div class="small">Practical business and startup courses.</div><a class="btn" href="https://www.udemy.com/courses/business/entrepreneurship/" target="_blank">View Udemy</a></div>
    </div>
  </div>

  <!-- Tenders -->
  <div class="section" id="tenders">
    <h3>Tender Learning & Workshops</h3>
    <p class="muted">eTenders, SEDA training and online workshops.</p>
    <div class="grid" style="margin-top:10px">
      <div class="card"><strong>eTenders</strong><div class="small">Official tender portal.</div><a class="btn" href="https://www.etenders.gov.za" target="_blank">Visit</a></div>
      <div class="card"><strong>SEDA Tender Training</strong><div class="small">Tender workshops and assistance.</div><a class="btn" href="https://www.seda.org.za" target="_blank">Visit</a></div>
      <div class="card"><strong>Online Workshops (YouTube)</strong><div class="small">Search recorded tender-writing classes.</div><a class="btn" href="https://www.youtube.com/results?search_query=tender+writing+workshop" target="_blank">YouTube</a></div>
    </div>
  </div>

  <!-- Partnerships -->
  <div class="section" id="partnerships">
    <h3>Partnerships & Grants</h3>
    <p class="muted">Recommended organisations & grant links.</p>
    <div class="grid" style="margin-top:10px"><div class="card"><strong>SEDA</strong><div class="small">Small business support</div></div><div class="card"><strong>Standard Bank</strong><div class="small">Business support programs</div></div><div class="card"><strong>Coega</strong><div class="small">Industrial partnerships</div></div></div>
  </div>

  <!-- Suppliers -->
  <div class="section" id="suppliers">
    <h3>Suppliers (by industry)</h3>
    <p class="muted">Suppliers relevant to your industry selection.</p>
    <div id="suppliers-grid" class="grid" style="margin-top:10px"></div>
  </div>

  <!-- Events & Community -->
  <div class="section" id="events">
    <h3>Events & Community</h3>
    <p class="muted">Local events, webinars & expos.</p>
    <div class="grid" style="margin-top:10px">
      <div class="card"><strong>Webinar: Digital Sales for SMEs</strong><div class="small">15 Nov 2025 ‚Ä¢ Online ‚Ä¢ Host: Spark Growth</div><a class="btn" href="https://www.eventbrite.com" target="_blank">Details</a></div>
      <div class="card"><strong>Entrepreneur Seminar: Scaling Smart</strong><div class="small">22 Nov 2025 ‚Ä¢ Johannesburg ‚Ä¢ Host: Biz Equip</div><a class="btn" href="#">Details</a></div>
      <div class="card"><strong>Tender Training Day (Live)</strong><div class="small">3 Dec 2025 ‚Ä¢ Cape Town ‚Ä¢ Host: SEDA</div><a class="btn" href="https://www.seda.org.za" target="_blank">Details</a></div>
    </div>
  </div>

  <!-- Videos -->
  <div class="section" id="videos">
    <h3>Video Tutorials</h3>
    <div class="grid" style="margin-top:10px">
      <div class="card"><iframe width="100%" height="170" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe></div>
      <div class="card"><iframe width="100%" height="170" src="https://www.youtube.com/embed/3JZ_D3ELwOQ" frameborder="0" allowfullscreen></iframe></div>
    </div>
  </div>

</div>

<script>
/* ============================
   Front-end dashboard script
   ============================ */

/* Load user */
const activeUser = JSON.parse(localStorage.getItem('activeUser'));
const signupUser = JSON.parse(localStorage.getItem('userData'));
const user = activeUser || signupUser || { fullname: 'Guest User', industry: 'General', goal: '' };

const displayName = document.getElementById('displayName');
const displayIndustry = document.getElementById('displayIndustry');
const avatarInitials = document.getElementById('avatarInitials');
const welcomeMsg = document.getElementById('welcomeMsg');

const name = user.fullname || user.name || 'Guest';
const industry = user.industry || 'General';
const goal = user.goal || '';

displayName.textContent = name;
displayIndustry.textContent = 'Industry: ' + industry;
avatarInitials.textContent = name.split(' ').map(n=>n[0]).slice(0,2).join('').toUpperCase();
welcomeMsg.textContent = `Welcome back, ${name} ‚Äî here's your dashboard overview.`;

/* Sidebar navigation */
document.querySelectorAll('.navlink').forEach(link=>{
  link.addEventListener('click', ()=> {
    const target = link.dataset.section;
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    const el = document.getElementById(target);
    if(el) el.classList.add('active');
    document.querySelector('.main').scrollTop = 0;
  });
});
document.getElementById('journey').classList.add('active');

/* Logout / edit profile */
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem('activeUser');
  window.location.href = 'index.html';
});
document.getElementById('editProfileBtn').addEventListener('click', ()=>{
  const newName = prompt('Full name:', name);
  if(newName === null) return;
  const newIndustry = prompt('Industry:', industry);
  if(newIndustry === null) return;
  const updated = { fullname: newName.trim(), industry: newIndustry.trim(), goal: user.goal || '' };
  localStorage.setItem('activeUser', JSON.stringify(updated));
  localStorage.setItem('userData', JSON.stringify(updated));
  location.reload();
});


/* -------------------------
   Mentors & Suppliers data
---------------------------*/
const mentors = [
  {name:'Sizwe Mthembu', company:'MicroTech Labs', province:'KwaZulu-Natal', city:'Durban', industries:['Technology','General'], goalTags:['Start a new business','Grow my business'], email:'sizwe@example.com', book:'https://calendly.com/example/sizwe' },
  {name:'Lerato Nkosi', company:'Spark Growth Agency', province:'Western Cape', city:'Cape Town', industries:['Retail','Technology','General'], goalTags:['Grow my business','Find funding'], email:'lerato@example.com', book:'https://calendly.com/example/lerato' },
  {name:'Bongani Dlamini', company:'CapitalRise', province:'Gauteng', city:'Johannesburg', industries:['Finance','Manufacturing','General'], goalTags:['Find funding','Access tenders'], email:'bongani@example.com', book:'https://calendly.com/example/bongani' },
  {name:'Thabo Mokoena', company:'ScaleWorks', province:'Eastern Cape', city:'Gqeberha', industries:['Construction','Operations','General'], goalTags:['Scale my business','Access tenders'], email:'thabo@example.com', book:'https://calendly.com/example/thabo' }
];

const supplierMap = {
  'Technology': [
    {name:'Tech Hardware SA', info:'Laptops & accessories', link:'#'},
    {name:'Local Print House', info:'Branding & printing', link:'#'}
  ],
  'Construction': [
    {name:'Buco', info:'Hardware & building supplies', link:'https://www.buco.co.za/'},
    {name:'Coega Development Corp', info:'Industrial procurement', link:'https://coega.co.za/'}
  ],
  'Food & Beverage': [
    {name:'Bakers Hub', info:'Baking supplies & equipment', link:'#'},
    {name:'Spar SA', info:'Retail partnerships', link:'https://www.spar.co.za/'}
  ],
  'Retail': [
    {name:'Wholesale Fabrics', info:'Textiles supplier', link:'#'},
    {name:'Office Depot', info:'Office supplies', link:'#'}
  ],
  'Manufacturing': [
    {name:'Industrial Suppliers Ltd', info:'Machinery & parts', link:'#'},
    {name:'Coca-Cola SA', info:'Supplier & distribution', link:'https://www.coca-cola.co.za/'}
  ],
  'Education': [
    {name:'Nelson Mandela University (NMU)', info:'Courses & bootcamps', link:'https://business.mandela.ac.za/'}
  ],
  'General': [
    {name:'SEDA', info:'Business support', link:'https://www.seda.org.za'},
    {name:'Standard Bank Grants', info:'Bank grant programs', link:'#'}
  ]
};

function renderMentors(){
  const grid = document.getElementById('mentors-grid');
  grid.innerHTML = '';
  const filtered = mentors.filter(m=>{
    return m.industries.includes(industry) || m.industries.includes('General') || (goal && m.goalTags.some(g=>g.toLowerCase().includes(goal.toLowerCase())));
  });
  const list = (filtered.length? filtered : mentors);
  list.forEach(m=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <strong>${m.name}</strong>
      <div class="small">${m.company} ‚Ä¢ ${m.city}, ${m.province}</div>
      <div class="smallmuted">Industries: ${m.industries.join(', ')} | Focus: ${m.goalTags.join(', ')}</div>
      <div style="margin-top:8px">
        <a class="btn" href="mailto:${m.email}?subject=Request%20for%20Mentor%20Intro&body=Hi%20${encodeURIComponent(m.name)}%2C%0A%0AI%20would%20like%20an%20introduction.%0A%0AUser:%20${encodeURIComponent(name)}" target="_blank">Request Intro</a>
        <a class="btn" href="${m.book}" target="_blank">Book 1:1</a>
      </div>
    `;
    grid.appendChild(div);
  });
}

function renderSuppliers(){
  const grid = document.getElementById('suppliers-grid');
  grid.innerHTML = '';
  const list = supplierMap[industry] || supplierMap['General'];
  list.forEach(s=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<strong>${s.name}</strong><div class="small">${s.info}</div><div style="margin-top:8px"><a class="btn" href="${s.link}" target="_blank">Visit</a></div>`;
    grid.appendChild(div);
  });
}
renderMentors();
renderSuppliers();

/* -------------------------
   Budget & Cashflow + pricing
---------------------------*/
function runBudget(){
  const income = parseFloat(document.getElementById('bp-income').value) || 0;
  const expenses = parseFloat(document.getElementById('bp-expenses').value) || 0;
  const profit = income - expenses;
  document.getElementById('bp-output').textContent = `Monthly Income: ZAR ${income.toFixed(2)} | Expenses: ZAR ${expenses.toFixed(2)} | Profit: ZAR ${profit.toFixed(2)}`;
  const csv = 'Item,Amount\nIncome,'+income+'\nExpenses,'+expenses+'\nProfit,'+profit;
  const href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  const a = document.getElementById('bp-download');
  a.href = href; a.download = 'budget-planner.csv'; a.style.display = 'inline-block';
}

function runCashflow(){
  const start = parseFloat(document.getElementById('cf-start').value) || 0;
  const monthly = parseFloat(document.getElementById('cf-month').value) || 0;
  let bal = start;
  const rows = [['Month','Balance']];
  for(let i=1;i<=12;i++){
    bal += monthly;
    rows.push([`M${i}`, bal.toFixed(2)]);
  }
  document.getElementById('cf-output').textContent = 'Projected balance after 12 months: ZAR ' + bal.toFixed(2);
  const csv = rows.map(r=>r.join(',')).join('\n');
  const href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  const a = document.getElementById('cf-download');
  a.href = href; a.download = 'cashflow-12months.csv'; a.style.display = 'inline-block';
}

function calcPrice(){
  const cost = parseFloat(document.getElementById('price-cost').value) || 0;
  const markup = parseFloat(document.getElementById('price-markup').value) || 0;
  const price = cost * (1 + markup/100);
  document.getElementById('price-output').textContent = `Suggested price: ZAR ${price.toFixed(2)} (cost ZAR ${cost.toFixed(2)})`;
  const csv = `Cost,Markup,Price\n${cost},${markup},${price.toFixed(2)}`;
  const a = document.getElementById('price-download');
  a.href = 'data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download = 'pricing.csv'; a.style.display = 'inline-block';
}

/* -------------------------
   Invoice / Quotation helpers
---------------------------*/
function addInvoiceRow(){
  const container = document.getElementById('invoice-items');
  const div = document.createElement('div');
  div.className = 'row item-row';
  div.innerHTML = `<div class="col"><input class="item-desc" placeholder="Description"></div>
    <div style="width:110px"><input class="item-qty" type="number" placeholder="Qty"></div>
    <div style="width:140px"><input class="item-price" type="number" placeholder="Unit price"></div>
    <div style="width:80px"><button class="btn" onclick="this.closest('.item-row').remove()">Del</button></div>`;
  container.appendChild(div);
}

function addQuoteRow(){
  const container = document.getElementById('quote-items');
  const div = document.createElement('div');
  div.className = 'row q-item';
  div.innerHTML = `<div class="col"><input class="q-desc" placeholder="Description"></div>
    <div style="width:110px"><input class="q-qty" type="number" placeholder="Qty"></div>
    <div style="width:140px"><input class="q-price" type="number" placeholder="Unit price"></div>
    <div style="width:80px"><button class="btn" onclick="this.closest('.q-item').remove()">Del</button></div>`;
  container.appendChild(div);
}

/* ---------- create XLSX ---------- */
function arrayToXLSX(rows, filename){
  /* rows = array of arrays */
  const ws = XLSX.utils.aoa_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, filename || 'export.xlsx');
}

/* -------------------------
   Invoice: XLSX / PDF / Email
---------------------------*/
function collectInvoiceData(){
  const invNo = document.getElementById('inv-no').value || 'INV-000';
  const date = document.getElementById('inv-date').value || new Date().toISOString().slice(0,10);
  const client = document.getElementById('inv-client').value || '';
  const email = document.getElementById('inv-client-email').value || '';
  const items = [...document.querySelectorAll('.item-row')].map(row=>{
    const d = row.querySelector('.item-desc').value || '';
    const q = parseFloat(row.querySelector('.item-qty').value) || 0;
    const p = parseFloat(row.querySelector('.item-price').value) || 0;
    const total = q*p;
    return {d,q,p,total};
  });
  return {invNo,date,client,email,items};
}

function generateInvoiceXLSX(){
  const data = collectInvoiceData();
  const rows = [['Invoice No', data.invNo], ['Date', data.date], ['Client', data.client], ['Client Email', data.email], [], ['Description','Qty','Unit Price','Total']];
  let grand = 0;
  data.items.forEach(it=>{
    rows.push([it.d, it.q, it.p.toFixed(2), it.total.toFixed(2)]);
    grand += it.total;
  });
  rows.push([]); rows.push(['Grand Total', '', '', grand.toFixed(2)]);
  arrayToXLSX(rows, `${data.invNo}.xlsx`);
  document.getElementById('inv-msg').textContent = `Downloaded ${data.invNo}.xlsx`;
}

async function generateInvoicePDF(){
  const { jsPDF } = window.jspdf;
  const data = collectInvoiceData();
  const doc = new jsPDF();
  let y = 12;
  doc.setFontSize(14); doc.text(`Invoice: ${data.invNo}`, 12, y); y+=8;
  doc.setFontSize(11); doc.text(`Date: ${data.date}`, 12, y); y+=7;
  doc.text(`Client: ${data.client}`, 12, y); y+=8;
  doc.text(`Items:`, 12, y); y+=6;
  doc.setFontSize(10);
  data.items.forEach(it=>{
    const line = `${it.d} ‚Äî ${it.q} x ZAR ${it.p.toFixed(2)} = ZAR ${it.total.toFixed(2)}`;
    doc.text(line, 14, y);
    y+=6;
    if(y > 270){ doc.addPage(); y=12; }
  });
  const grand = data.items.reduce((s,i)=>s+i.total,0);
  y+=6; doc.setFontSize(11); doc.text(`Grand Total: ZAR ${grand.toFixed(2)}`, 12, y);
  doc.save(`${data.invNo}.pdf`);
  document.getElementById('inv-msg').textContent = `Downloaded ${data.invNo}.pdf`;
}

async function emailInvoice(){
  const data = collectInvoiceData();
  // Prepare payload
  const payload = {
    type: 'invoice',
    invoice: data,
    user: { name, industry }
  };
  // POST to Netlify function (you'll deploy this separately)
  try {
    const res = await fetch('/.netlify/functions/send-email', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify(payload)
    });
    if(!res.ok) throw new Error('No function');
    const json = await res.json();
    alert('Email send request successful: ' + (json.message || 'OK'));
  } catch(err){
    alert('No email function detected yet. The invoice can be downloaded as XLSX or PDF, then attached manually. ('+err.message+')');
  }
}

/* -------------------------
   Quotation: XLSX / PDF / Email
---------------------------*/
function collectQuoteData(){
  const no = document.getElementById('qt-no').value || 'QT-000';
  const date = document.getElementById('qt-date').value || new Date().toISOString().slice(0,10);
  const client = document.getElementById('qt-client').value || '';
  const email = document.getElementById('qt-client-email').value || '';
  const items = [...document.querySelectorAll('.q-item')].map(row=>{
    const d = row.querySelector('.q-desc').value || '';
    const q = parseFloat(row.querySelector('.q-qty').value) || 0;
    const p = parseFloat(row.querySelector('.q-price').value) || 0;
    const total = q*p;
    return {d,q,p,total};
  });
  return {no,date,client,email,items};
}

function generateQuoteXLSX(){
  const data = collectQuoteData();
  const rows = [['Quotation No', data.no], ['Date', data.date], ['Client', data.client], ['Client Email', data.email], [], ['Description','Qty','Unit Price','Total']];
  let grand=0;
  data.items.forEach(it=>{
    rows.push([it.d, it.q, it.p.toFixed(2), it.total.toFixed(2)]);
    grand += it.total;
  });
  rows.push([]); rows.push(['Grand Total','','',grand.toFixed(2)]);
  arrayToXLSX(rows, `${data.no}.xlsx`);
  document.getElementById('qt-msg').textContent = `Downloaded ${data.no}.xlsx`;
}

async function generateQuotePDF(){
  const { jsPDF } = window.jspdf;
  const data = collectQuoteData();
  const doc = new jsPDF();
  let y=12;
  doc.setFontSize(14); doc.text(`Quotation: ${data.no}`, 12, y); y+=8;
  doc.setFontSize(11); doc.text(`Date: ${data.date}`, 12, y); y+=7;
  doc.text(`Client: ${data.client}`, 12, y); y+=8;
  doc.setFontSize(10);
  data.items.forEach(it=>{
    doc.text(`${it.d} ‚Äî ${it.q} x ZAR ${it.p.toFixed(2)} = ZAR ${it.total.toFixed(2)}`, 14, y);
    y+=6;
    if(y>270){ doc.addPage(); y=12; }
  });
  const grand = data.items.reduce((s,i)=>s+i.total,0);
  y+=6; doc.setFontSize(11); doc.text(`Grand Total: ZAR ${grand.toFixed(2)}`, 12, y);
  doc.save(`${data.no}.pdf`);
  document.getElementById('qt-msg').textContent = `Downloaded ${data.no}.pdf`;
}

async function emailQuote(){
  const data = collectQuoteData();
  const payload = { type:'quote', quote:data, user:{name,industry} };
  try {
    const res = await fetch('/.netlify/functions/send-email', {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
    });
    if(!res.ok) throw new Error('No function');
    const json = await res.json();
    alert('Email send request successful: ' + (json.message || 'OK'));
  } catch(err){
    alert('No email function detected yet. Download the file and attach manually. ('+err.message+')');
  }
}

/* -------------------------
   Templates (XLSX and DOC)
---------------------------*/
const invoiceTemplateRows = [
  ['Invoice No','Date','Client','Client Email','Description','Qty','Unit Price','Total'],
  ['INV-001','2025-01-01','Your Client','client@example.com','Service A',1,100.00,100.00]
];
const quoteTemplateRows = [
  ['Quotation No','Date','Client','Client Email','Description','Qty','Unit Price','Total'],
  ['QT-001','2025-01-01','Your Client','client@example.com','Product A',10,50.00,500.00]
];
const businessPlanDoc = `Business Plan Template

1. Executive Summary
2. Business Description
3. Products & Services
4. Market Analysis
5. Sales & Marketing
6. Operations Plan
7. Financial Plan
8. Appendix
`;

document.getElementById('download-invoice-template').addEventListener('click', (e)=>{
  e.preventDefault(); arrayToXLSX(invoiceTemplateRows,'invoice-template.xlsx');
});
document.getElementById('download-quote-template').addEventListener('click', (e)=>{
  e.preventDefault(); arrayToXLSX(quoteTemplateRows,'quotation-template.xlsx');
});
document.getElementById('download-plan-template').addEventListener('click', (e)=>{
  e.preventDefault();
  const href = 'data:application/msword;charset=utf-8,'+encodeURIComponent(businessPlanDoc);
  const a = document.createElement('a'); a.href = href; a.download='business-plan-template.doc'; a.click();
});

/* -------------------------
   Final initial UI setup
---------------------------*/
document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
document.getElementById('journey').classList.add('active');

</script>
</body>
</html>
